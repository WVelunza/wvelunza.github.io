<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="geolocation=*">
    <meta http-equiv="Permissions-Policy" content="geolocation=*, camera=*, microphone=*">
    <title>Tronbot Widgets</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style> 
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: Poppins, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: transparent; }
        
        /* Tronbot Widgets Styles */
        .tronbot-box-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.125rem; padding: 1rem; }
        .tronbot-box { min-height: 200px; display: flex; flex-direction: column; gap: 1.125rem; background: white; border: 1px solid #e1e1e1; border-radius: 1rem; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); padding: 1.25rem; transition: all 0.2s ease; }
        .tronbot-box-header { display: flex; align-items: center; gap: 0.625rem; color: #1a3557; font-size: 1rem; font-weight: 600; line-height: 1.3em; border-bottom: 1px solid #e1e1e1; padding-bottom: 1.25rem; }
        .tronbot-box-header img { width: 1.875rem; height: 1.875rem; }
        
        /* Todo Widget Elements */
        .tronbot-todo-header { display: flex; align-items: center; justify-content: space-between; }
        .tronbot-todo-header-left { display: flex; align-items: center; gap: 0.625rem; }
        .tronbot-clear-tasks-btn { cursor: pointer; background: transparent; color: #02a8d6; font-size: 0.9rem; border: 1px solid; border-radius: 0.313rem; padding: 0.313rem 0.625rem; transition: all 0.2s linear; }
        .tronbot-clear-tasks-btn:hover { background: #02a8d6; color: white; }
        .tronbot-progress-bar-bg { overflow: hidden; position: relative; width: 100%; height: 1.25rem; background: #eee; border-radius: 0.625rem; }
        .tronbot-progress-bar-fill { width: 0%; height: 100%; background: #02a8d6; transition: width 0.5s; }
        .tronbot-progress-percent-label { position: absolute; left: 50%; top: 50%; transform: translateX(-50%) translateY(-50%); font-size: 0.9rem; color: black; font-weight: 600; line-height: 1em; }
        .tronbot-motivation-msg { min-height: 1.25rem; color: #02a8d6; font-size: 1rem; font-weight: 500; }
        .tronbot-todo-input { width: 100%; border: 1px solid #e1e1e1; border-radius: 0.625rem; padding: 0.625rem; }
        .tronbot-todo-item { display: flex; align-items: center; gap: 1rem; padding: 0.313rem; border-bottom: 1px solid #e1e1e1; }
        .tronbot-todo-input:focus { outline: 2px solid #02a8d6; outline-offset: 2px; }
        .tronbot-todo-item input[type="checkbox"] { cursor: pointer; width: 18px; height: 18px; accent-color: #02a8d6; }
        
        /* Quick Links */
        .tronbot-quick-links-list { width: 100%; display: flex; flex-direction: column; gap: 1.125rem; }
        .tronbot-quick-link-row { cursor: pointer; display: flex; align-items: center; gap: 1rem; background: linear-gradient(45deg, rgb(2, 168, 214) 0%, rgb(58, 74, 96) 100%); color: white; border-radius: 0.625rem; box-shadow: 0 5px 15px rgba(27, 127, 162, 0.25); padding: 1rem; transition: all 0.2s linear; }
        .tronbot-quick-link-row:hover { transform: translateY(-2px) scale(1.015); }
        .tronbot-quick-link-row img { width: 1.875rem; height: 1.875rem; flex-shrink: 0; filter: brightness(1.5) grayscale(1); }
        .tronbot-quick-link-row > div { display: flex; flex-direction: column; justify-content: center; }
        .tronbot-quick-link-row > div > div:first-child { font-size: 1rem; font-weight: 600; line-height: 1.3em; color: white; }
        .tronbot-quick-link-row > div > div:last-child { color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; line-height: 1.3em; }
        
        /* Weather Widget */
        .tronbot-weather-content { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .tronbot-weather-content img { display: block; width: 100px; height: 100px; }
        .tronbot-weather-temp { color: #1B3557; font-size: 2.5rem; font-weight: 700; }
        .tronbot-weather-content > div:last-child { font-size: 1.125rem; color: #1B3557; text-transform: capitalize; }
        .tronbot-weather-location { font-size: 1rem; font-weight: 400; margin-left: auto; }
        
        /* Tips Widget */
        .tronbot-tip-highlight-bg { background: #EAF4FB; border-left: 4px solid #05A8D6; border-radius: 0.625rem; padding: 1.25rem; }
        .tronbot-tip-heading { display: inline-block; width: 100%; background: #b6d6f6; color: #1B3557; font-size: 1rem; font-weight: 600; border-radius: 0.625rem; margin-bottom: 1rem; padding: 1rem; }
        .tronbot-tip-content { color: #23405a; font-size: 0.9rem; font-weight: 500; line-height: 1.6em; }
    </style>
</head>
<body>
    <div class="tronbot-box-container" id="tronbot-widgets-container">
        <!-- Widgets will be dynamically inserted here -->
    </div>
    
    <script>
        (function() {
            'use strict';
            
            // Initialize widgets
            function initializeTronbotWidgets() {
                const container = document.getElementById('tronbot-widgets-container');
                if (!container) return;
                
                // Icon URLs
                const icons = {
                    weather: "https://img.icons8.com/ios/50/1a3557/partly-cloudy-day--v1.png",
                    tips: "https://img.icons8.com/ios/50/1a3557/idea.png",
                    focus: "https://img.icons8.com/ios/50/1a3557/checked-checkbox.png",
                    quickLinks: "https://img.icons8.com/ios/50/1a3557/link--v1.png"
                };
                
                // Create main widget boxes
                for (let i = 1; i <= 4; i++) {
                    const box = document.createElement('div');
                    box.className = 'tronbot-box';
                    
                    if (i === 1) {
                        // Weather Box
                        box.innerHTML = `
                            <div class="tronbot-box-header">
                                <img src="${icons.weather}" alt="Weather">
                                Current Weather
                            </div>
                            <div class="tronbot-weather-content">Loading...</div>
                        `;
                        setupWeatherWidget(box);
                    } else if (i === 2) {
                        // Tips Box
                        box.innerHTML = `
                            <div class="tronbot-box-header">
                                <img src="${icons.tips}" alt="Tip">
                                Your Daily Tip
                            </div>
                            <div class="tronbot-tip-content">Loading...</div>
                        `;
                        setupTipsWidget(box);
                    } else if (i === 3) {
                        // Todo Box
                        box.innerHTML = `
                            <div class="tronbot-box-header tronbot-todo-header">
                                <span class="tronbot-todo-header-left">
                                    <img src="${icons.focus}" alt="Focus">
                                    Today's Focus
                                </span>
                                <button class="tronbot-clear-tasks-btn">Clear List</button>
                            </div>
                            <div class="tronbot-progress-bar-bg">
                                <div class="tronbot-progress-bar-fill"></div>
                            </div>
                            <div class="tronbot-todo-list"></div>
                            <input class="tronbot-todo-input" placeholder="Add task + enter...">
                        `;
                        setupTodoWidget(box);
                    } else {
                        // Quick Links Box
                        box.innerHTML = `
                            <div class="tronbot-box-header">
                                <img src="${icons.quickLinks}" alt="Links">
                                Quick Links
                            </div>
                            <div class="tronbot-quick-links-list"></div>
                        `;
                        setupQuickLinks(box);
                    }
                    
                    container.appendChild(box);
                }
            }
            
            // Helper to extract domain and locationId from URL
            function getDomainAndLocationId() {
                const { origin, pathname } = window.location;
                const match = pathname.match(/\/location\/([^/]+)/);
                
                return {
                    domain: origin,
                    locationId: match ? match[1] : ''
                };
            }
            
            // Quick Links Setup
            function setupQuickLinks(quickLinksBox) {
                const { domain, locationId } = getDomainAndLocationId();
                
                const quickLinks = [
                    { heading: "New Lead", description: "Grow your database", url: `${domain}/v2/location/${locationId}/contacts/smart_list/All` },
                    { heading: "Schedule", description: "Book new meeting", url: `${domain}/v2/location/${locationId}/calendars/view` },
                    { heading: "Social Post", description: "Stay in front of your fans today!", url: `${domain}/v2/location/${locationId}/marketing/social-planner/planner` },
                    { heading: "Email Blast", description: "The GOLD is in the follow up!", url: `${domain}/v2/location/${locationId}/marketing/emails/scheduled?pageNumber=1` }
                ];
                
                const quickLinksList = quickLinksBox.querySelector('.tronbot-quick-links-list');
                const quickLinksIcons = {
                    "New Lead": "https://img.icons8.com/ios/40/ffffff/add-user-group-man-man.png",
                    "Schedule": "https://img.icons8.com/ios/40/ffffff/calendar--v1.png",
                    "Social Post": "https://img.icons8.com/ios/40/ffffff/share-2.png",
                    "Email Blast": "https://img.icons8.com/ios/40/ffffff/new-post.png"
                };
                
                quickLinks.forEach(link => {
                    const row = document.createElement('div');
                    row.className = 'tronbot-quick-link-row';
                    row.innerHTML = `
                        <img src="${quickLinksIcons[link.heading] || ''}" alt="${link.heading}">
                        <div>
                            <div>${link.heading}</div>
                            <div>${link.description}</div>
                        </div>
                    `;
                    row.addEventListener('click', () => window.open(link.url, '_parent'));
                    quickLinksList.appendChild(row);
                });
            }
            
// Weather Widget Setup - REAL WEATHER ONLY
function setupWeatherWidget(weatherBox) {
    const apiKey = '4c6ee9b0e8b4fb36b76c86c3b0e6c1e0';
    
    function getWeatherIcon(condition, temperature) {
        const baseUrl = "https://www.amcharts.com/wp-content/themes/amcharts4/css/img/icons/weather/animated/";
        
        if (condition.includes("rain")) {
            return baseUrl + "rainy-6.svg";
        } else if (condition.includes("cloud")) {
            return baseUrl + "cloudy-day-3.svg";
        } else if (condition.includes("snow")) {
            return baseUrl + "snowy-6.svg";
        } else if (temperature >= 86) {
            return baseUrl + "day.svg";
        } else if (temperature <= 50) {
            return baseUrl + "snowy-3.svg";
        } else {
            return baseUrl + "cloudy-day-1.svg";
        }
    }

    // Get weather by city name - REAL DATA ONLY
    async function getWeatherByCity(cityName) {
        const response = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=${apiKey}&units=imperial`
        );
        
        if (!response.ok) {
            throw new Error('City not found');
        }
        
        const data = await response.json();
        return {
            name: data.name,
            temp: Math.round(data.main.temp),
            desc: data.weather[0].description,
            condition: data.weather[0].main.toLowerCase(),
            country: data.sys.country
        };
    }

    // Get weather by coordinates - REAL DATA ONLY
    async function getWeatherByCoords(lat, lon) {
        const response = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=imperial`
        );
        
        if (!response.ok) {
            throw new Error('Weather API failed');
        }
        
        const data = await response.json();
        return {
            name: data.name,
            temp: Math.round(data.main.temp),
            desc: data.weather[0].description,
            condition: data.weather[0].main.toLowerCase(),
            country: data.sys.country
        };
    }

    // Try geolocation
    function tryGeolocation() {
        return new Promise((resolve, reject) => {
            if (!navigator.geolocation) {
                reject(new Error('Geolocation not supported'));
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    resolve({
                        lat: position.coords.latitude,
                        lon: position.coords.longitude
                    });
                },
                (error) => {
                    reject(new Error('Geolocation permission denied'));
                },
                {
                    timeout: 10000,
                    enableHighAccuracy: false
                }
            );
        });
    }

    // Show city input when geolocation fails
    function showCityInput() {
        weatherBox.innerHTML = `
            <div class="tronbot-box-header">
                <img src="https://img.icons8.com/ios/50/1a3557/partly-cloudy-day--v1.png" alt="Weather">
                Weather
            </div>
            <div class="tronbot-weather-content" style="gap: 1rem;">
                <div style="color: #666; font-size: 0.9rem; text-align: center;">
                    📍 Location access needed for weather
                </div>
                <input 
                    type="text" 
                    placeholder="Enter your city (e.g., Miami, FL)" 
                    style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 0.5rem; font-size: 0.9rem;"
                    id="cityInput"
                >
                <button 
                    onclick="searchWeather()" 
                    style="width: 100%; padding: 0.75rem; background: #02a8d6; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 500;"
                >
                    Get Weather
                </button>
            </div>
        `;

        // Add search function
        window.searchWeather = async function() {
            const input = document.getElementById('cityInput');
            const city = input.value.trim();
            
            if (!city) {
                alert('Please enter a city name');
                return;
            }

            // Show loading
            weatherBox.querySelector('.tronbot-weather-content').innerHTML = `
                <div style="padding: 2rem; text-align: center; color: #666;">
                    🌤️ Getting weather for ${city}...
                </div>
            `;

            try {
                const weatherData = await getWeatherByCity(city);
                showWeatherData(weatherData);
                localStorage.setItem('tronbot-weather-city', city);
            } catch (error) {
                weatherBox.querySelector('.tronbot-weather-content').innerHTML = `
                    <div style="color: #e74c3c; text-align: center; padding: 1rem;">
                        ❌ Could not find weather for "${city}"
                        <br><small>Try: "Miami", "New York", "Los Angeles"</small>
                    </div>
                    <button onclick="location.reload()" style="width: 100%; padding: 0.75rem; background: #02a8d6; color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
                        Try Again
                    </button>
                `;
            }
        };
    }

    // Display real weather data
    function showWeatherData(weatherData) {
        const iconUrl = getWeatherIcon(weatherData.condition, weatherData.temp);
        
        weatherBox.innerHTML = `
            <div class="tronbot-box-header">
                <img src="https://img.icons8.com/ios/50/1a3557/partly-cloudy-day--v1.png" alt="Weather">
                Current Weather 
                <span class="tronbot-weather-location">${weatherData.name}</span>
            </div>
            <div class="tronbot-weather-content">
                <img src="${iconUrl}" alt="Weather" style="max-width: 100px; height: auto;">
                <div class="tronbot-weather-temp">${weatherData.temp}°F</div>
                <div style="text-transform: capitalize;">${weatherData.desc}</div>
                <small style="color: #02a8d6; margin-top: 0.5rem;">
                    🌍 Live weather data
                </small>
            </div>
        `;
    }

    // Main initialization - NO FAKE WEATHER
    async function initWeather() {
        // Show loading
        weatherBox.innerHTML = `
            <div class="tronbot-box-header">
                <img src="https://img.icons8.com/ios/50/1a3557/partly-cloudy-day--v1.png" alt="Weather">
                Current Weather
            </div>
            <div class="tronbot-weather-content">
                <div style="padding: 2rem; text-align: center; color: #666;">
                    🌤️ Loading weather...
                </div>
            </div>
        `;

        // Check if user has a saved city
        const savedCity = localStorage.getItem('tronbot-weather-city');
        if (savedCity) {
            try {
                const weatherData = await getWeatherByCity(savedCity);
                showWeatherData(weatherData);
                return;
            } catch (error) {
                localStorage.removeItem('tronbot-weather-city');
            }
        }

        // Try geolocation
        try {
            const coords = await tryGeolocation();
            const weatherData = await getWeatherByCoords(coords.lat, coords.lon);
            showWeatherData(weatherData);
        } catch (error) {
            // Show city input - NO RANDOM CITIES
            showCityInput();
        }
    }

    // Start weather widget
    initWeather();
}
            
            // Tips Widget Setup
            function setupTipsWidget(tipsBox) {
                const tips = [
                    { title: "Use Tags Effectively", description: "Navigate to the 'Tags' section in the settings menu. Click on 'Create New Tag' and give it a meaningful name. Assign the tag to contacts by editing their profiles. Use tags to filter and segment your contacts for targeted campaigns." },
                    { title: "Automate Follow-Ups", description: "Go to the 'Workflows' section in your dashboard. Create a new workflow and add a follow-up email or SMS action. Set the timing for the follow-up (e.g., 1 day after contact). Activate the workflow to automate your follow-ups." },
                    { title: "Track Campaign Performance", description: "Navigate to the 'Analytics' section in your dashboard. Select the campaign you want to analyze. Review metrics like open rates, click-through rates, and conversions. Use the insights to optimize your future campaigns." },
                    { title: "Set Up Appointment Reminders", description: "Go to the 'Appointments' section in your dashboard. Configure automated reminders for your appointments. Choose the timing (e.g., 1 hour before the appointment). Link the reminders to your calendar for seamless scheduling." },
                    { title: "Leverage Pipelines", description: "Navigate to the 'Pipelines' section in your dashboard. Create a new pipeline and define its stages (e.g., Lead, Contacted, Closed). Add contacts to the pipeline and move them through the stages. Use pipelines to track and manage your sales process effectively." }
                ];
                
                const randomTip = tips[Math.floor(Math.random() * tips.length)];
                
                tipsBox.innerHTML = `
                    <div class="tronbot-box-header">
                        <img src="https://img.icons8.com/ios/50/1a3557/idea.png" alt="Tip">
                        Daily Tips
                    </div>
                    <div class="tronbot-tip-highlight-bg">
                        <div class="tronbot-tip-heading">${randomTip.title}</div>
                        <div class="tronbot-tip-content">${randomTip.description}</div>
                    </div>
                `;
            }
            
            // Todo Widget Setup
            function setupTodoWidget(todoBox) {
                const todoList = todoBox.querySelector('.tronbot-todo-list');
                const todoInput = todoBox.querySelector('.tronbot-todo-input');
                const progressBar = todoBox.querySelector('.tronbot-progress-bar-fill');
                const clearBtn = todoBox.querySelector('.tronbot-clear-tasks-btn');
                
                // Add progress elements
                const motivationMsg = document.createElement('div');
                motivationMsg.className = 'tronbot-motivation-msg';
                progressBar.parentNode.after(motivationMsg);
                
                const percentLabel = document.createElement('span');
                percentLabel.className = 'tronbot-progress-percent-label';
                progressBar.parentNode.appendChild(percentLabel);
                
                const getMotivation = (percent) => {
                    if (percent === 0) return "Let's get started! 🚀";
                    if (percent < 30) return "Keep going, you can do it! 💪";
                    if (percent < 60) return "Nice progress, stay focused! ✨";
                    if (percent < 100) return "Almost there, finish strong! 🏁";
                    return "All done! Great job! 🎉";
                };
                
                const updateProgress = () => {
                    const total = todoList.children.length;
                    if (total === 0) {
                        progressBar.style.width = '0%';
                        motivationMsg.textContent = getMotivation(0);
                        percentLabel.textContent = '0%';
                        percentLabel.style.color = '#1B3557';
                        return;
                    }
                    
                    const completed = Array.from(todoList.children).filter(item => item.querySelector('input').checked).length;
                    const percent = Math.round((completed / total) * 100);
                    
                    progressBar.style.width = percent + '%';
                    motivationMsg.textContent = getMotivation(percent);
                    percentLabel.textContent = percent + '%';
                    percentLabel.style.color = percent >= 50 ? 'white' : '#1B3557';
                };
                
                const saveTasks = () => {
                    const tasks = Array.from(todoList.children).map(item => ({
                        text: item.querySelector('span').textContent.trim(),
                        checked: item.querySelector('input').checked
                    }));
                    localStorage.setItem('tronbot-url-tasks', JSON.stringify(tasks));
                    updateProgress();
                };
                
                const addTask = (task, checked = false) => {
                    if (!task || task.trim() === '') return;
                    
                    const taskItem = document.createElement('div');
                    taskItem.className = 'tronbot-todo-item';
                    taskItem.innerHTML = `
                        <input type="checkbox" ${checked ? 'checked' : ''}>
                        <span style="flex:1;${checked ? 'text-decoration: line-through; color: #aaa;' : ''}">${task}</span>
                    `;
                    
                    const checkbox = taskItem.querySelector('input');
                    const span = taskItem.querySelector('span');
                    
                    checkbox.addEventListener('change', () => {
                        if (checkbox.checked) {
                            span.style.textDecoration = 'line-through';
                            span.style.color = '#aaa';
                        } else {
                            span.style.textDecoration = '';
                            span.style.color = '';
                        }
                        saveTasks();
                    });
                    
                    todoList.appendChild(taskItem);
                    updateProgress();
                };
                
                // Load saved tasks
                const tasks = JSON.parse(localStorage.getItem('tronbot-url-tasks')) || [];
                tasks.forEach(task => {
                    if (task && task.text) addTask(task.text, task.checked);
                });
                
                // Event listeners
                todoInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && todoInput.value.trim()) {
                        addTask(todoInput.value.trim());
                        todoInput.value = '';
                        saveTasks();
                    }
                });
                
                clearBtn.addEventListener('click', () => {
                    todoList.innerHTML = '';
                    localStorage.removeItem('tronbot-url-tasks');
                    updateProgress();
                });
                
                updateProgress();
            }
            
            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeTronbotWidgets);
            } else {
                initializeTronbotWidgets();
            }
        })();
    </script>
</body>
</html>
